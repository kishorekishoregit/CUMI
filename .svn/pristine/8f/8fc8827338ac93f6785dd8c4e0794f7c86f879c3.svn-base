jQuery(function ($) {
    BindTable();
    var ID = '';
    var GRNNO = '';
    var ITEMCODE = '';
    var ITEMNAME = '';
    var LOTNO = '';
    var QUANTITY = '';
    var REJECTEDQUANTITY = '';
    var NETWEIGHT = '';
    var GROSSWEIGHT = '';
    var REMARKS = '';
    function BindTable() {

        var table = document.getElementById("dynamic-table-rmquality");
        var cols = [];
        var cols1 = [];
        var cols1DATA = [];
        var nullvalue;
        var colsresult;
        var finalcolsresult;

        var RoleDatatable = $('#dynamic-table-rmquality');
        $(".loader").show("slow");
        $.ajax({
            url: 'GetRMQualityPageLoad',
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (Result) {

                var pageload = Result;
                var rmdetails = JSON.parse(pageload);
             
                BindTab(rmdetails, '1');
              //  $('td:nth-child(2),th:nth-child(2)').hide()
            }
        });
        $(".loader").hide("slow");
    }
    function BindTab(ResData, type) {

        var currentDate = new Date()
        var day = currentDate.getDate()
        var month = currentDate.getMonth() + 1
        var year = currentDate.getFullYear()
        var currentdate = day + "/" + month + "/" + year;

        var cols = [];
        var cols1 = [];
        var cols1DATA = [];
        var nullvalue;
        var colsresult;
        var finalcolsresult;
        var elements = Array();
        var exampleRecord = ResData[0];
        // TABLE BIND     
        if (type == '0') {
            $('#dynamic-table-rmquality').dataTable().fnDestroy();
            cols.length = 0;
            cols1.length = 0;
        }
        if (exampleRecord) {
            //get keys in object. This will only work if your statement remains true that all objects have identical keys
            var keys = Object.keys(exampleRecord);

            //for each key, add a column definition
            keys.forEach(function (k) {
                cols.push({
                    title: k,
                    data: k,
                    targets: k

                    //optionally do some type detection here for render function
                });
            });

            $.each(cols, function (index, item) {

                item.title, item.targets

                cols1.push({
                    title: item.title,
                    targets: index

                });

                cols1DATA.push({
                    data: item.title,
                });
                finalcolsresult += 'null' + ',';

            });

            var dyTable = $('#dynamic-table-rmquality');

            $('#dynamic-table-rmquality').dataTable({
                data: ResData,
                "bAutoWidth": false,
                "info": false,
                "ascrollX": "100%",
                "language": { "search": "" },
                "bPaginate": false,
                "aColumns": [
          finalcolsresult,
          { "bSortable": false }
                ],
                "aSorting": [],
                'columnDefs': [{
                    'targets': 0,
                    'searchable': true,
                    'orderable': true,
                    'className': 'dt-body-center'
                }],

                columnDefs: cols1,
                columns: [

                    { 'data': 'Select' },
                    { 'data': 'ID' },
                     { 'data': 'Grn No' },
                     { 'data': 'Item Code' },
                     { 'data': 'Item Name' },
                     { 'data': 'Lot No' },
                     { 'data': 'Quantity' },
                     { 'data': 'Net Wt' },
                     { 'data': 'Gross Wt' },
                     { 'data': 'Price' },
                      //{

                      //    'data': 'Accept',
                      //    'render': function (data, type, full, meta) {

                      //        return '<button type="button" class="btn btn-success btn-fab thumbsupdetails" id="Thumbsup" data-toggle="tooltip" data-placement="top" title="Thumbsup"><i class="fa fa-thumbs-up" aria-hidden="true"></i></button>'

                      //    }
                      //},
                      // {

                      //     'data': 'Reject',
                      //     'render': function (data, type, full, meta) {

                      //         return '<button type="button" class="btn btn-danger btn-fab thumbsdowndetails" id="Thumbsdown" data-toggle="tooltip" data-placement="top" title="Thumbsdown"><i class="fa fa-thumbs-down" aria-hidden="true"></i></button>'

                      //     }
                      // },
                    

                ],
                dom: 'Bfrti',
                buttons: [

                    {
                        extend: 'excelHtml5',
                        title: 'RMQuality',
                        text: '<img src="../../Images/excel.png" style="height: 25px;">',
                        footer: false
                    },
                    {
                        extend: 'pdfHtml5',

                        text: '<img src="../../Images/pdf.png" style="height: 25px;">',
                        orientation: 'landscape',
                        pageSize: 'A4',
                        footer: false,
                        title: 'RMQuality'


                    }, {
                        extend: 'print',
                        title: 'RMQuality',
                        text: '<img src="../../Images/print.png" style="height: 25px;">',
                        footer: false
                    }
                ]
            });
        }
        else {
            $('#dynamic-table-rmquality tbody').remove();
            $('#dynamic-table-rmquality thead').remove();
            $('#dynamic-table-rmquality').dataTable({
                "language": {
                    "emptyTable": "RMQuality No records found.."
                },
                'bSort': false,
                'aoColumns': [
                    { sWidth: "10%", bSearchable: false, bSortable: false },
                    { sWidth: "10%", bSearchable: false, bSortable: false },
                          { sWidth: "10%", bSearchable: false, bSortable: false },
                            { sWidth: "10%", bSearchable: false, bSortable: false },
                              { sWidth: "10%", bSearchable: false, bSortable: false },
                                  { sWidth: "10%", bSearchable: false, bSortable: false },
                                    { sWidth: "10%", bSearchable: false, bSortable: false },
                                        { sWidth: "10%", bSearchable: false, bSortable: false },
                                            { sWidth: "10%", bSearchable: false, bSortable: false },
                                                    { sWidth: "10%", bSearchable: false, bSortable: false }

                ],
                "scrollCollapse": false,
                "info": true,
                "paging": false,
                "searching": true
            });


        }
        $(".loader").hide("slow");
    }



    $("#btnaccept").click(function () {
       
        jQuery("table.checkupload tbody > tr").each(function () {

            if (jQuery('td:eq(0)', this).children('input.checkbox').is(':checked')) {

               // locationcode += jQuery('td:eq(1)', this).text() + "^";
                ID += $(this).closest('tr').find('td:eq(1)').html() + "^";
                GRNNO += $(this).closest('tr').find('td:eq(2)').html() + "^";
                ITEMCODE += $(this).closest('tr').find('td:eq(3)').html() + "^";
                ITEMNAME += $(this).closest('tr').find('td:eq(4)').html() + "^";
                LOTNO += $(this).closest('tr').find('td:eq(5)').html() + "^";
                QUANTITY += $(this).closest('tr').find('td:eq(6)').html() + "^";
                REJECTEDQUANTITY = "0";
                NETWEIGHT += $(this).closest('tr').find('td:eq(7)').html() + "^";
                GROSSWEIGHT += $(this).closest('tr').find('td:eq(8)').html() + "^";
                REMARKS = '';
                LOTSTATUS = "ACCEPT";
            }

        });

        $(".loader").show("slow");

        $.ajax({
            url: 'InsertRMQuality',
            dataType: "json",
            type: "POST",
            data: $.param({ 'ID': ID })
                + '&' + $.param({ 'GRNNO': GRNNO })
                + '&' + $.param({ 'ITEMCODE': ITEMCODE })
                + '&' + $.param({ 'ITEMNAME': ITEMNAME })
                + '&' + $.param({ 'LOTNO': LOTNO })
                + '&' + $.param({ 'QUANTITY': QUANTITY })
                + '&' + $.param({ 'REJECTEDQUANTITY': REJECTEDQUANTITY })
                + '&' + $.param({ 'NETWEIGHT': NETWEIGHT })
                + '&' + $.param({ 'GROSSWEIGHT': GROSSWEIGHT })
                + '&' + $.param({ 'REMARKS': REMARKS })
                + '&' + $.param({ 'LOTSTATUS': LOTSTATUS }),
            //  data:formData,
            success: function (data) {

                var Res = data.split('|');
                var result = Res[0];
                var msg = Res[1];
                if (result.toUpperCase() == "TRUE") {
                    // $("form").trigger("reset");

                    $('.loadingGIF').hide();
                    sweetAlert("", msg.replace(/&quot;/g, "").replace(/<Br \/>/g, "\n"), "success");
                    Clear();
                }
                else {
                    $('.loadingGIF').hide();
                    sweetAlert("", msg.replace(/&quot;/g, "").replace(/<Br \/>/g, "\n"), "error");

                }
            }
        });
      
        $(".loader").hide("slow");

    });


    $("#btnreject").click(function () {

        jQuery("table.checkupload tbody > tr").each(function () {

            if (jQuery('td:eq(0)', this).children('input.checkbox').is(':checked')) {
                ID += $(this).closest('tr').find('td:eq(1)').html() + "^";
                GRNNO += $(this).closest('tr').find('td:eq(2)').html() + "^";
                ITEMCODE += $(this).closest('tr').find('td:eq(3)').html() + "^";
                ITEMNAME += $(this).closest('tr').find('td:eq(4)').html() + "^";
                LOTNO += $(this).closest('tr').find('td:eq(5)').html() + "^";
                QUANTITY += $(this).closest('tr').find('td:eq(6)').html() + "^";
              //  REJECTEDQUANTITY = "0";
                NETWEIGHT += $(this).closest('tr').find('td:eq(7)').html() + "^";
                GROSSWEIGHT += $(this).closest('tr').find('td:eq(8)').html() + "^";
              //  REMARKS = '';
                LOTSTATUS = "REJECT";

                
            }

        });

        $('#modalview').modal('show');
    });



    //$("#dynamic-table-rmquality").on("click", ".thumbsupdetails", function () {

    //     GRNNO = $(this).closest('tr').find('td:eq(0)').html();
    //     ITEMCODE = $(this).closest('tr').find('td:eq(1)').html();
    //     ITEMNAME = $(this).closest('tr').find('td:eq(2)').html();
    //     LOTNO = $(this).closest('tr').find('td:eq(3)').html();
    //     QUANTITY = $(this).closest('tr').find('td:eq(4)').html();
    //     REJECTEDQUANTITY = "0";
    //     NETWEIGHT = $(this).closest('tr').find('td:eq(5)').html();
    //     GROSSWEIGHT = $(this).closest('tr').find('td:eq(6)').html();
    //     REMARKS = '';
    //     LOTSTATUS = "ACCEPT";
    //    $(".loader").show("slow");
        
    //    $.ajax({
    //        url: 'InsertRMQuality',
    //        dataType: "json",
    //        type: "POST",
    //        data: $.param({ 'GRNNO': GRNNO })
    //            + '&' + $.param({ 'ITEMCODE': ITEMCODE })
    //            + '&' + $.param({ 'ITEMNAME': ITEMNAME })
    //            + '&' + $.param({ 'LOTNO': LOTNO })
    //            + '&' + $.param({ 'QUANTITY': QUANTITY })
    //            + '&' + $.param({ 'REJECTEDQUANTITY': REJECTEDQUANTITY })
    //            + '&' + $.param({ 'NETWEIGHT': NETWEIGHT })
    //            + '&' + $.param({ 'GROSSWEIGHT': GROSSWEIGHT })
    //            + '&' + $.param({ 'REMARKS': REMARKS })
    //            + '&' + $.param({ 'LOTSTATUS': LOTSTATUS }),
    //        //  data:formData,
    //        success: function (data) {

    //            var Res = data.split('|');
    //            var result = Res[0];
    //            var msg = Res[1];
    //            if (result.toUpperCase() == "TRUE") {
    //               // $("form").trigger("reset");
                   
    //                $('.loadingGIF').hide();
    //                sweetAlert("", msg.replace(/&quot;/g, "").replace(/<Br \/>/g, "\n"), "success");
                   
    //            }
    //            else {
    //                $('.loadingGIF').hide();
    //                sweetAlert("", msg.replace(/&quot;/g, "").replace(/<Br \/>/g, "\n"), "error");

    //            }
    //        }
    //    });
    //    Clear();
    //    $(".loader").hide("slow");
    //});
    //$("#dynamic-table-rmquality").on("click", ".thumbsdowndetails", function () {
    //    GRNNO = $(this).closest('tr').find('td:eq(0)').html();
    //    ITEMCODE = $(this).closest('tr').find('td:eq(1)').html();
    //    ITEMNAME = $(this).closest('tr').find('td:eq(2)').html();
    //    LOTNO = $(this).closest('tr').find('td:eq(3)').html();
    //    QUANTITY = $(this).closest('tr').find('td:eq(4)').html();
    //    NETWEIGHT = $(this).closest('tr').find('td:eq(5)').html();
    //    GROSSWEIGHT = $(this).closest('tr').find('td:eq(6)').html();
    //     LOTSTATUS = "REJECT";

    //    $('#modalview').modal('show');

        
    //});

    $('#btnsubmit').click(function () {
        REJECTEDQUANTITY = $('#txtrejectedqty').val();
        REMARKS = $('#txtremarks').val();
        var errmsg = "";
        if ($('#txtrejectedqty').val() == "")
        {
            errmsg += "Rejected Quantity Cannot be left Empty.\n";
        }
        if ($('#txtremarks').val() == "") {
            errmsg += "Remarks Cannot be left Empty.";
        }
        if (errmsg.length == 0) {

        
        $('.loadingGIF').show();

        
        $(".loader").show("slow");

        $.ajax({
            url: 'InsertRMQuality',
            dataType: "json",
            type: "POST",
            data: $.param({ 'ID': ID })
                + '&' + $.param({ 'GRNNO': GRNNO })
                + '&' + $.param({ 'ITEMCODE': ITEMCODE })
                + '&' + $.param({ 'ITEMNAME': ITEMNAME })
                + '&' + $.param({ 'LOTNO': LOTNO })
                + '&' + $.param({ 'QUANTITY': QUANTITY })
                + '&' + $.param({ 'REJECTEDQUANTITY': REJECTEDQUANTITY })
                + '&' + $.param({ 'NETWEIGHT': NETWEIGHT })
                + '&' + $.param({ 'GROSSWEIGHT': GROSSWEIGHT })
                + '&' + $.param({ 'REMARKS': REMARKS })
                + '&' + $.param({ 'LOTSTATUS': LOTSTATUS }),
            //  data:formData,
            success: function (data) {

                var Res = data.split('|');
                var result = Res[0];
                var msg = Res[1];

                if (result.toUpperCase() == "TRUE") {
                    // $("form").trigger("reset");

                    $('#modalview').modal('hide');
                    $('#txtrejectedqty').val('');
                    $('#txtremarks').val('');
                    sweetAlert("", msg.replace(/&quot;/g, "").replace(/<Br \/>/g, "\n"), "success");
                   
                }
                else {
                   
                    sweetAlert("", msg.replace(/&quot;/g, "").replace(/<Br \/>/g, "\n"), "error");
                    
                }
            }
        });
        }else
        {
            sweetAlert("", errmsg.replace(/&quot;/g, "").replace(/<Br \/>/g, "\n"), "error");
        }
        //Clear();
        $(".loader").hide("slow");
    });


    $('#btnclear').click(function () {
       $('#txtrejectedqty').val('');
       $('#txtremarks').val('');
       
      

    });


    function Clear() {

        location.reload();

    }
    //$('#checkall').change(function () {
    //    if ($(this).is(":checked")) {
    //        $('.isselect').attr("checked", true);
    //    } else {
    //        $('.isselect').attr("checked", false);
    //    }

    //});

    $('#checkall').click(function (event) {
        if (this.checked) {
            // Iterate each checkbox
            $(':checkbox').each(function () {
                this.checked = true;
            });
        } else {
            $(':checkbox').each(function () {
                this.checked = false;
            });
        }
    });

});